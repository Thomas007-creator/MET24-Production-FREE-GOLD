# üöÄ Complete Deployment Guide - MET24 Production

**Van Lokaal naar DigitalOcean Droplet**  
**Datum**: 30 September 2025  
**Droplet**: MET24-Production (4GB RAM, 80GB Disk, FRA1)  
**IP**: 165.227.136.245

---

## üìã **Overzicht Deployment Proces**

### **Stap 1**: Lokaal Development ‚Üí GitHub
### **Stap 2**: GitHub ‚Üí Coolify Dashboard  
### **Stap 3**: Coolify ‚Üí DigitalOcean Droplet
### **Stap 4**: Domain ‚Üí SSL Certificaten
### **Stap 5**: Monitoring & Maintenance

---

## üè† **STAP 1: Lokaal Development**

### **1.1 Project Setup**
```bash
# Clone repository
git clone https://github.com/Thomas007-creator/MET24-Production.git
cd MET24-Production

# Install dependencies
npm install

# Start development server
npm start
```

### **1.2 Environment Variables (Lokaal)**
```bash
# .env.local
REACT_APP_SUPABASE_URL=https://your-supabase-project-id.supabase.co
REACT_APP_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
VAPID_PUBLIC_KEY=your-vapid-public-key-here
VAPID_PRIVATE_KEY=your-vapid-private-key-here
VAPID_EMAIL=mailto:thomas@your-future-self.app
```

### **1.3 Development Features**
- ‚úÖ **AI Buddy Interface** - `/ai-buddy`
- ‚úÖ **AI Buddy Test** - `/test-ai-buddy`
- ‚úÖ **SmartFilteringService** - Memory context, refusal logic
- ‚úÖ **PWA Features** - Offline support, push notifications
- ‚úÖ **MBTI Coach** - Complete coaching system

---

## üì§ **STAP 2: GitHub Push**

### **2.1 Code Commits**
```bash
# Add all changes
git add -A

# Commit with descriptive message
git commit -m "üöÄ Complete AI Buddy Implementation - GPT-5 & Grok-4 Roadmap"

# Push to main branch
git push origin main
```

### **2.2 GitHub Repository**
- **Repository**: `Thomas007-creator/MET24-Production`
- **Branch**: `main`
- **Latest Commit**: `96fe601` - Deployment problems documentation
- **Status**: ‚úÖ All code pushed and ready

---

## üåê **STAP 3: Coolify Dashboard Setup**

### **3.1 Coolify Access**
1. **Login** to Coolify Dashboard
2. **Navigate** to Projects
3. **Select** or create project: `MET24-Production`

### **3.2 Repository Connection**
```
Repository: Thomas007-creator/MET24-Production
Branch: main
Build Pack: Docker
Dockerfile: Dockerfile.production
```

### **3.3 Environment Variables (Coolify)**
```bash
# Critical Variables
REACT_APP_SUPABASE_URL=https://your-supabase-project-id.supabase.co
REACT_APP_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
VAPID_PUBLIC_KEY=your-vapid-public-key-here
VAPID_PRIVATE_KEY=your-vapid-private-key-here
VAPID_EMAIL=mailto:osteomedica.utrecht@gmail.com
SSL_EMAIL=osteomedica.utrecht@gmail.com
ENABLE_SSL=true
DOMAIN=www.your-future-self.app

# Optional AI Provider Keys
GROK_API_KEY=your_grok_api_key_here
OPENAI_API_KEY=your_openai_api_key_here
ANTHROPIC_API_KEY=your_anthropic_api_key_here
MCP_API_KEY=your_mcp_api_key_here
```

### **3.4 Deployment Configuration**
```yaml
# docker-compose.yml (Auto-generated by Coolify)
version: '3.8'
services:
  traefik:
    image: traefik:v2.10
    command:
      - "--entrypoints.web.address=:80"
      - "--entrypoints.websecure.address=:443"
      - "--certificatesresolvers.letsencrypt.acme.tlschallenge=true"
  
  met24-user-app:
    build: .
    environment:
      - NODE_ENV=production
      - REACT_APP_SUPABASE_URL=${REACT_APP_SUPABASE_URL}
      - VAPID_PUBLIC_KEY=${VAPID_PUBLIC_KEY}
      - VAPID_PRIVATE_KEY=${VAPID_PRIVATE_KEY}
      - VAPID_EMAIL=${VAPID_EMAIL}
```

---

## üñ•Ô∏è **STAP 4: DigitalOcean Droplet**

### **4.1 Droplet Specifications**
```
Name: MET24-Production
Size: 4 GB Memory / 80 GB Disk
Region: FRA1 (Frankfurt)
OS: Ubuntu 24.04 (LTS) x64
IPv4: 165.227.136.245
IPv6: 2a03:b0c0:3:f0:0:1:5a0c:8000
```

### **4.2 Server Setup (Automatisch via Coolify)**
```bash
# Coolify automatically installs:
- Docker Engine
- Docker Compose
- Traefik Reverse Proxy
- Let's Encrypt SSL
- Health Monitoring
```

### **4.3 Manual Server Access (Indien nodig)**
```bash
# SSH to server
ssh root@165.227.136.245

# Check running containers
docker ps

# View logs
docker logs met24-user-app
docker logs met24-mcp-bridge
docker logs traefik

# Restart services
docker-compose restart
```

---

## üåç **STAP 5: Domain & SSL**

### **5.1 Domain Configuration**
```
Domain: www.your-future-self.app
A Record: 165.227.136.245
CNAME: your-future-self.app ‚Üí www.your-future-self.app
```

### **5.2 SSL Certificaten (Automatisch)**
```bash
# Let's Encrypt (via Traefik)
- Certificate: /letsencrypt/live/www.your-future-self.app/
- Auto-renewal: Enabled
- HTTPS Redirect: Enabled
```

### **5.3 Service URLs**
```
‚úÖ https://www.your-future-self.app ‚Üí User App (Port 3000)
‚úÖ https://www.your-future-self.app/mcp ‚Üí MCP Bridge (Port 3001)
‚úÖ https://www.your-future-self.app/health ‚Üí Health Check
‚úÖ https://www.your-future-self.app/ai-buddy ‚Üí AI Buddy Interface
‚úÖ https://www.your-future-self.app/test-ai-buddy ‚Üí AI Buddy Test
```

---

## üîß **STAP 6: Deployment Process**

### **6.1 Coolify Deployment Flow**
```
1. GitHub Webhook ‚Üí Coolify
2. Coolify ‚Üí Clone Repository
3. Docker Build ‚Üí Production Image
4. Deploy ‚Üí DigitalOcean Droplet
5. Traefik ‚Üí Route Traffic
6. SSL ‚Üí Generate Certificates
7. Health Check ‚Üí Verify Services
```

### **6.2 Build Process**
```bash
# Docker Build (Automatisch)
FROM node:18-alpine
WORKDIR /app
COPY package*.json ./
RUN npm ci --silent
COPY . .
RUN npm run build
EXPOSE 3000
CMD ["npm", "start"]
```

### **6.3 Service Architecture**
```
Internet ‚Üí Traefik (Port 80/443) ‚Üí User App (Port 3000)
                    ‚Üì
                MCP Bridge (Port 3001)
                    ‚Üì
                Supabase Database
```

---

## üìä **STAP 7: Monitoring & Health**

### **7.1 Health Checks**
```bash
# User App Health
curl https://www.your-future-self.app/health
# Response: {"status": "healthy", "timestamp": "2025-09-30T18:00:00Z"}

# MCP Bridge Health  
curl https://www.your-future-self.app/mcp/health
# Response: {"status": "healthy", "services": ["grok-3", "openai", "anthropic"]}
```

### **7.2 Log Monitoring**
```bash
# Coolify Dashboard Logs
- Build Logs: Docker build process
- Runtime Logs: Application output
- Traefik Logs: Routing and SSL
- Error Logs: Debugging information
```

### **7.3 Performance Monitoring**
```
- CPU Usage: Monitor via DigitalOcean Dashboard
- Memory Usage: 4GB RAM allocation
- Disk Usage: 80GB storage
- Network: Bandwidth monitoring
- SSL: Certificate expiration alerts
```

---

## üö® **STAP 8: Troubleshooting**

### **8.1 Common Issues**

#### **Traefik Entrypoint Errors**
```
Error: entryPoint "http" doesn't exist
Solution: Redeploy in Coolify Dashboard
```

#### **Environment Variables Missing**
```
Error: VAPID_PUBLIC_KEY is undefined
Solution: Add to Coolify Environment Variables
```

#### **SSL Certificate Issues**
```
Error: Certificate generation failed
Solution: Check domain DNS settings
```

### **8.2 Debug Commands**
```bash
# Check container status
docker ps -a

# View specific logs
docker logs met24-user-app --tail 100
docker logs traefik --tail 100

# Restart specific service
docker restart met24-user-app

# Full redeploy
docker-compose down && docker-compose up -d
```

---

## üéØ **STAP 9: Success Verification**

### **9.1 Deployment Checklist**
```
‚úÖ GitHub Repository: Code pushed
‚úÖ Coolify Dashboard: Project configured
‚úÖ Environment Variables: All set
‚úÖ DigitalOcean Droplet: Running
‚úÖ Domain DNS: Pointing to server
‚úÖ SSL Certificates: Generated
‚úÖ User App: Accessible via domain
‚úÖ MCP Bridge: Accessible via /mcp
‚úÖ AI Buddy: Working at /ai-buddy
‚úÖ Health Checks: Passing
```

### **9.2 Feature Testing**
```
‚úÖ PWA Installation: Works offline
‚úÖ Push Notifications: VAPID keys working
‚úÖ AI Buddy Interface: Memory context active
‚úÖ SmartFilteringService: Refusal logic working
‚úÖ MBTI Coach: Complete coaching flow
‚úÖ Database Sync: Supabase integration
```

---

## üìà **STAP 10: Maintenance & Updates**

### **10.1 Regular Updates**
```bash
# Code updates
git add -A
git commit -m "Update: Description"
git push origin main
# Coolify auto-deploys
```

### **10.2 Server Maintenance**
```bash
# System updates
apt update && apt upgrade -y

# Docker cleanup
docker system prune -f

# Log rotation
logrotate /etc/logrotate.conf
```

### **10.3 Backup Strategy**
```
- Database: Supabase automatic backups
- Code: GitHub repository
- Environment: Coolify configuration
- SSL: Let's Encrypt auto-renewal
```

---

## üèÜ **Deployment Summary**

### **‚úÖ Successfully Deployed:**
- **AI Buddy System** - Complete implementation
- **PWA Features** - Offline support, push notifications
- **Security** - VAPID keys, input validation, rate limiting
- **Database** - Supabase integration with PWA features
- **SSL** - Let's Encrypt certificates
- **Monitoring** - Health checks and logging

### **üåê Live URLs:**
- **Main App**: https://www.your-future-self.app
- **AI Buddy**: https://www.your-future-self.app/ai-buddy
- **MCP Bridge**: https://www.your-future-self.app/mcp
- **Health Check**: https://www.your-future-self.app/health

### **üñ•Ô∏è Server Info:**
- **Droplet**: MET24-Production (4GB RAM, 80GB Disk)
- **Location**: FRA1 (Frankfurt)
- **IP**: 165.227.136.245
- **OS**: Ubuntu 24.04 (LTS) x64

---

**üéØ Complete deployment from local development to production DigitalOcean droplet successfully configured and running!**
